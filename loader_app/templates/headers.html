{% extends "base.html" %}
{% block content %}

<small>Overall progress</small>
<div class="progress">
  <div class="progress-bar" role="progressbar" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100" style="width: 25%;">
    <span class="sr-only">25% Complete</span>
  </div>
</div>

<script type="text/javascript">
$(function () {
  $('[data-toggle="popover"]').popover()
})
</script>

<h3>Align session headers</h3>
<button type="button" class="btn btn-default" data-toggle="modal" data-target="#instructionsModal">
  Show instructions
</button>

<div class="container">
    <form action="" ng-controller="HeaderController as headerCtrl" method="POST" name="headerForm" id="headerForm" ng-submit="headerCtrl.checkFields()" novalidate>
    
    <div class="col-xs-12">&nbsp</div>
    
    <!-- Scientific Name -->
    <div class="row">
        <div class="form-group col-md-6 col-xs-12" id="scientificNameSelect">    
            <label for="scientificName" class="control-label">Scientific Name</label>
            <select class="form-control" ng-model="headerCtrl.headers.scientificName" id="scientificName" name="scientificName">
            {% for header in session['file_headers'] %}
                <option value="{{header}}">{{header}}</option>
            {% endfor %}
            </select>
        </div>
        <div class=" form-group col-md-6 col-xs-12" id="scientificNameDefaultInput">
            <label for="scientificNameDefault" class="control-label col-md-12 hidden-xs hidden-sm">&nbsp</label>
            <input type="text" class="form-control" ng-model="headerCtrl.headers.scientificNameDefault" id="scientificNameDefault" name="scientificNameDefault" placeholder="Default value for Scientific Name, text">
        </div>
    </div>

    <!-- decimalLatitude -->
    <div class="row">
        <div class="form-group col-md-6 col-xs-12" id="decimalLatitudeSelect">    
            <label for="decimalLatitude" class="control-label">Latitude (in decimal degrees)</label>
            <select class="form-control" ng-model="headerCtrl.headers.decimalLatitude" id="decimalLatitude" name="decimalLatitude">
            {% for header in session['file_headers'] %}
                <option value="{{header}}">{{header}}</option>
            {% endfor %}
            </select>
        </div>
        <div class=" form-group col-md-6 col-xs-12" id="decimalLatitudeDefaultInput">
            <label for="decimalLatitudeDefault" class="control-label col-md-12 hidden-xs hidden-sm">&nbsp</label>
            <input type="number" class="form-control" ng-model="headerCtrl.headers.decimalLatitudeDefault" id="decimalLatitudeDefault" name="decimalLatitudeDefault" placeholder="Default value for Latitude, number between -90 and 90" min="-90" max="90">
        </div>
    </div>

    <!-- decimalLongitude -->
    <div class="row">
        <div class="form-group col-md-6 col-xs-12" id="decimalLongitudeSelect">    
            <label for="decimalLongitude" class="control-label">Longitude (in decimal degrees)</label>
            <select class="form-control" ng-model="headerCtrl.headers.decimalLongitude" id="decimalLongitude" name="decimalLongitude">
            {% for header in session['file_headers'] %}
                <option value="{{header}}">{{header}}</option>
            {% endfor %}
            </select>
        </div>
        <div class=" form-group col-md-6 col-xs-12" id="decimalLongitudeDefaultInput">
            <label for="decimalLongitudeDefault" class="control-label col-md-12 hidden-xs hidden-sm">&nbsp</label>
            <input type="number" class="form-control" ng-model="headerCtrl.headers.decimalLongitudeDefault" id="decimalLongitudeDefault" name="decimalLongitudeDefault" placeholder="Default value for Longitude, number between -180 and 180" min="-180" max="180">
        </div>
    </div>

    <!-- coordinateUncertaintyInMeters -->
    <div class="row">
        <div class="form-group col-md-6 col-xs-12" id="coordinateUncertaintyInMetersSelect">    
            <label for="coordinateUncertaintyInMeters" class="control-label">Coord. Uncertainty (in meters)</label>
            <select class="form-control" ng-model="headerCtrl.headers.coordinateUncertaintyInMeters" id="coordinateUncertaintyInMeters" name="coordinateUncertaintyInMeters">
            {% for header in session['file_headers'] %}
                <option value="{{header}}">{{header}}</option>
            {% endfor %}
            </select>
        </div>
        <div class=" form-group col-md-6 col-xs-12" id="coordinateUncertaintyInMetersDefaultInput">
            <label for="coordinateUncertaintyInMetersDefault" class="control-label col-md-12 hidden-xs hidden-sm">&nbsp</label>
            <input type="number" class="form-control" ng-model="headerCtrl.headers.coordinateUncertaintyInMetersDefault" id="coordinateUncertaintyInMetersDefault" name="coordinateUncertaintyInMetersDefault" placeholder="Default value for uncertainty, in meters, number">
        </div>
    </div>

    <!-- eventDate -->
    <div class="row">
        <div class="form-group col-md-6 col-xs-12" id="eventDateSelect">    
            <label for="eventDate" class="control-label">Date and Time</label>
            <select class="form-control" ng-model="headerCtrl.headers.eventDate" id="eventDate" name="eventDate">
            {% for header in session['file_headers'] %}
                <option value="{{header}}">{{header}}</option>
            {% endfor %}
            </select>
        </div>
        <div class=" form-group col-md-6 col-xs-12" id="eventDateDefaultInput">
            <label for="eventDateDefault" class="control-label col-md-12 hidden-xs hidden-sm">&nbsp</label>
            <input type="text" class="form-control" ng-model="headerCtrl.headers.eventDateDefault" id="eventDateDefault" name="eventDateDefault" placeholder="Default value for Date and Time, text, ISO8601 compliant format">
        </div>
    </div>

    <!-- recordedBy -->
    <div class="row">
        <div class="form-group col-md-6 col-xs-12" id="recordedBySelect">    
            <label for="recordedBy" class="control-label">Observer</label>
            <select class="form-control" ng-model="headerCtrl.headers.recordedBy" id="recordedBy" name="recordedBy">
            {% for header in session['file_headers'] %}
                <option value="{{header}}">{{header}}</option>
            {% endfor %}
            </select>
        </div>
        <div class=" form-group col-md-6 col-xs-12" id="recordedByDefaultInput">
            <label for="recordedByDefault" class="control-label col-md-12 hidden-xs hidden-sm">&nbsp</label>
            <input type="text" class="form-control" ng-model="headerCtrl.headers.recordedByDefault" id="recordedByDefault" name="recordedByDefault" placeholder="Default value for Observer, text">
        </div>
    </div>

    <div class="alert alert-danger" id="warningMessage" ng-show="headerCtrl.warning" >
        <button type="button" class="close" data-dismiss="alert">
        <span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        {[{ headerCtrl.warning }]}
    </div>

    <input class="btn btn-primary" type="submit" value="Next" ng-disabled="headerForm.$invalid">
    </form>
</div>


<!-- INSTRUCTIONS MODAL -->
<div class="modal fade" id="instructionsModal" tabindex="-1" role="dialog" aria-labelledby="instructionsModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="instructionsModalLabel">Header alignment</h4>
      </div>
      <div class="modal-body">
      
      <p>This step is what we call header (or field) alignment. In order to properly map your records, we need to know where to find certain pieces of information from your file. In this section, we ask you to tell us which of the fields in your file correspond to these basic terms:
      <ul>
        <li><a href="#" data-toggle="popover" data-trigger="focus" data-placement="right" title="DarwinCore definition" data-content="The full scientific name, with authorship and date information if known. When forming part of an Identification, this should be the name in lowest level taxonomic rank that can be determined. This term should not contain identification qualifications, which should instead be supplied in the IdentificationQualifier term.">Scientific Name</a></li>
        <li><a href="#" data-toggle="popover" data-trigger="focus" data-placement="right" title="DarwinCore definition" data-content="The geographic latitude (in decimal degrees, using the spatial reference system given in geodeticDatum) of the geographic center of a Location. Positive values are north of the Equator, negative values are south of it. Legal values lie between -90 and 90, inclusive.">Latitude</a></li>
        <li><a href="#" data-toggle="popover" data-trigger="focus" data-placement="right" title="DarwinCore definition" data-content="The geographic longitude (in decimal degrees, using the spatial reference system given in geodeticDatum) of the geographic center of a Location. Positive values are east of the Greenwich Meridian, negative values are west of it. Legal values lie between -180 and 180, inclusive.">Longitude</a></li>
        <li><a href="#" data-toggle="popover" data-trigger="focus" data-placement="right" title="DarwinCore definition" data-content="The horizontal distance (in meters) from the given decimalLatitude and decimalLongitude describing the smallest circle containing the whole of the Location. Leave the value empty if the uncertainty is unknown, cannot be estimated, or is not applicable (because there are no coordinates). Zero is not a valid value for this term.">Coordinate Uncertainty</a></li>
        <li><a href="#" data-toggle="popover" data-trigger="focus" data-placement="right" title="DarwinCore definition" data-content="The date-time or interval during which an Event occurred. For occurrences, this is the date-time when the event was recorded. Not suitable for a time in a geological context. Recommended best practice is to use an encoding scheme, such as ISO 8601:2004(E).">Date and Time</a></li>
<!--
        <li><a href="#" data-toggle="popover" data-placement="right" title="DarwinCore definition" data-content="The ellipsoid, geodetic datum, or spatial reference system (SRS) upon which the geographic coordinates given in decimalLatitude and decimalLongitude as based. Recommended best practice is use the EPSG code as a controlled vocabulary to provide an SRS, if known. Otherwise use a controlled vocabulary for the name or code of the geodetic datum, if known. Otherwise use a controlled vocabulary for the name or code of the ellipsoid, if known. If none of these is known, use the value 'unknown'.">geodeticDatum</a></li>
-->
        <li><a href="#" data-toggle="popover" data-trigger="focus" data-placement="right" title="DarwinCore definition" data-content="A list (concatenated and separated) of names of people, groups, or organizations responsible for recording the original Occurrence. The primary collector or observer, especially one who applies a personal identifier (recordNumber), should be listed first.">Observer</a></li>

      </ul>
      </p>

      <p>If your records have a common individual value for any of these fields and the field itself is absent from the CSV file (for example, if all your coordinates are given using WGS84 Datum and, therefore, the geodeticDatum field is missing from yout file), you should leave the field alignment empty but specify a default value in the corresponding default field (in the previous case, leave geodeticDatum empty and put 'WGS84' in the 'default' field). This value will be applied to all records.</p>

      <p><strong>It is important that you specify either a header alignment or a default value for each of these terms. The program will not continue unless every term has either an aligned field or a default value.</strong></p>

      <p>After all fields have been filled, the program will parse the content of your file, performing some basic quality checks. Among others, it will check for completeness of these fields. If any record has missing values in any aligned field, it will return to the main page and show you a list of the issues you need to fix in order to complete the process. Completeness checks can be overridden by assigning a default value in aligned fields. For any field, if you align the field and specify a default value, the parser will take the value in the record if present and apply the default if not.</p>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Got it!</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}
