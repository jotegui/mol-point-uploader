{% extends "base.html" %}
{% block content %}

<div class="container" ng-controller="RecordController as recordCtrl">
    
    <div class="row" ng-hide="loading" ng-init="centroid={{centroid}}">

        <div class="col-xs-6">
            <h2>{[{ title }]}</h2>
        </div>
        

        <div class="col-xs-6" ng-show="mapAvailable">
            <div class="btn-toolbar pull-right" role="toolbar">
                
                <!-- all/species toggle -->
                <div id="speciesbuttons" class="btn-group" role="group">
                    <input type="button" id="allspeciesfield" class="btn btn-primary" disabled value="{[{speciesBtn}]}">

                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-expanded="false" value="Single species">
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu">
                            <li ng-click="updateFilter('All species')"><a id="allspecies">All species</a></li>
                            <li ng-click="updateFilter(species)" ng-repeat="species in allSpecies"><a id="{[{ species.replace(" ", "_") }]}">{[{ species }]}</a></li>
                        </ul>
                    </div>
                </div>

                <!-- annotate button -->
                <div role="group" class="btn-group" data-toggle="buttons">
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#annotateModal" ng-show="tab === 'map'">
                        Annotate
                    </button>
                </div>

                <!-- list/map switch -->
                <div role="group" class="btn-group" data-toggle="buttons">
                    <label class="btn btn-primary active" ng-click="tab = 'map'">
                        <input type="radio" name="view" id="mapView" autocomplete="off">Map
                    </label>
                    <label class="btn btn-primary" ng-click="tab = 'list'">
                        <input type="radio" name="view" id="listView" autocomplete="off" checked>List
                    </label>
                </div>

            </div>
        </div>

    </div>
    
    
    <!--List panel-->
    <div id="listPanel" class="active" ng-show="!loading && mapAvailable && tab === 'list'">
        <div id="table-container">
            <div>{[{allPoints.length}]} records</div>
            <table class="table table-striped table-bordered tabe-hover" infinite-scroll="loadMore()" infinite-scroll-disabled="tab === 'map'">
                <thead>
                    <tr>
                        <th>Scientific name</th>
                        <th>Coordinates</th>
                        <th>Event date</th>
                        <th>Recorded by</th>
                        <th>Uncertainty</th>
                        <th>Geodetic Datum</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" class="form-control" ng-model="search.scientificname"></td>
                        <td><input type="text" class="form-control" ng-model="search.coordinates"></td>
                        <td><input type="text" class="form-control" ng-model="search.eventdate"></td>
                        <td><input type="text" class="form-control" ng-model="search.recordedby"></td>
                        <td><input type="text" class="form-control" ng-model="search.coordinateuncertaintyinmeters"></td>
                        <td><input type="text" class="form-control" ng-model="search.geodeticdatum"></td>
                    </tr>
                    <tr ng-repeat="point in pointsFiltered = (points | filter: search)">
                        <td>{[{point.scientificname}]}</td>
                        <td>{[{point.coordinates}]}</td>
                        <td>{[{point.eventdate}]}</td>
                        <td>{[{point.recordedby}]}</td>
                        <td>{[{point.coordinateuncertaintyinmeters}]}</td>
                        <td>{[{point.geodeticdatum}]}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    
    </div>
    
    
    
    <!--Map panel-->
    <div id="mapPanel" class="active" ng-show="!loading && mapAvailable && tab === 'map'">
        <style>
            #map_canvas {height: 650px; }
            .legend {
                line-height: 18px;
                color: #555;
                background-color: #FFF;
                opacity: 0.8;
            }
            .legend i {
                width: 18px;
                height: 18px;
                float: left;
                margin-right: 8px;
                opacity: 0.7;
            }
        </style>
        <div id="map_canvas" class="well"></div>
        
        <script>

            

        </script>

    </div>



    <!--Show "No map available" text if no data has been retrieved-->
    <div ng-hide="mapAvailable || loading">
        <p>No map available</p>
    </div>

    <div ng-show="loading">
        <p>Loading data</p>
    </div>
    
    
    <script>
$(document).ready(function() {
    $('#recordsTable').dataTable();

    // annotations
    $('#submitAnnotation').on( 'click', function (event) {
        var form = $("#annotateModal").find('form');
        var annotateURL = 'https://api.mol.org/annotate?' + $( form ).serialize();
        if (selectedSpecies != "") {
            annotateURL += "&scientificname=" + selectedSpecies;
        }

        location.href = annotateURL;
        $('#annotateModal').modal('hide')
    });

} );
</script>
</div>


<!-- Annotate Modal -->
<div class="modal fade" id="annotateModal" tabindex="-1" role="dialog" aria-labelledby="annotateModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="annotateModalLabel">Annotate</h4>
      </div>
      <div class="modal-body">
        <form>
            <input type="hidden" name="datasetid" value="{{ datasetid }}" />
            <!-- annotation datasets -->
          <div class="form-group">
            <label class="control-label">Annotation dataset</label>
            <div class="checkbox">
              <label>
                <input type="checkbox" name="annotations" value="MCD43A4_EVI">
                MCD43A4_EVI - MODIS 16day EVI (500m)
              </label>
            </div>
            <div class="checkbox">
              <label>
                <input type="checkbox" name="annotations" value="MOD11A2">
                MOD11A2 - MODIS 8-day LST (1000m)
              </label>
            </div>
            <div class="checkbox">
              <label>
                <input type="checkbox" name="annotations" value="MODCF">
                MODCF - MODIS Monthly Average Cloud Frequency (1000m)
              </label>
            </div>
            <div class="checkbox">
              <label>
                <input type="checkbox" name="annotations" value="worldclim_tmean">
                worldclim_tmean - WorldClim Monthly Average Temperature (1000m)
              </label>
            </div>
            <div class="checkbox">
              <label>
                <input type="checkbox" name="annotations" value="worldclim_prec">
                worldclim_prec - WorldClim Monthly Total Precipitation (1000m)
              </label>
            </div>
          </div>

            <!-- -->
            <div class="form-group">
                <label class="control-label">Spatial grain</label>
                <div>
                <label class="checkbox-inline">
                    <input type="checkbox" name="spatial_grain" value="1000"> 1km
                </label>
                <label class="checkbox-inline">
                    <input type="checkbox" name="spatial_grain" value="2000"> 2km
                </label>
                <label class="checkbox-inline">
                    <input type="checkbox" name="spatial_grain" value="4000"> 4km
                </label>
                <label class="checkbox-inline">
                    <input type="checkbox" name="spatial_grain" value="8000"> 8km
                </label>
                <label class="checkbox-inline">
                    <input type="checkbox" name="spatial_grain" value="16000"> 16km
                </label>
                <label class="checkbox-inline">
                    <input type="checkbox" name="spatial_grain" value="32000"> 32km
                </label>
                <label class="checkbox-inline">
                    <input type="checkbox" name="spatial_grain" value="64000"> 64km
                </label>
                <label class="checkbox-inline">
                    <input type="checkbox" name="spatial_grain" value="128000   "> 128km
                </label>
                </div>
            </div>

            <!-- buffer -->
          <div class="form-group">
            <label for="annotation-buffer" class="control-label">Buffer: 1km (default)</label>
            <!-- <textarea class="form-control" id="annotation-buffer"></textarea> -->
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="submitAnnotation">Annotate</button>
      </div>
    </div>
  </div>
</div>


{% endblock %}
